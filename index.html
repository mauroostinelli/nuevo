<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gobernanza Energética - Diseño Interactivo</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <h1>Gobernanza Energética</h1>
        <p>Diseña interactivamente la gobernanza de tu comunidad energética</p>
    </header>

    <main id="governance-constructor">
        <form id="governance-form">

            <div id="progress-bar-container">
                <div id="progress-bar"></div>
                <span id="progress-step-text">Paso 1 de X</span>
            </div>

            <div id="steps-container">

                <section id="step-1" class="step active">
                    <h2>Paso 1: Define tu comunidad</h2>

                    <div class="module">
                        <h3><span class="principle-tag">P7</span> Propósito principal y beneficios</h3>
                        <p>Selecciona los objetivos clave. ¿Cuál será el foco principal?</p>
                        <div id="purpose-selector" class="interactive-area grid-checkboxes">
                            <label><input type="checkbox" name="purpose" value="reducir_facturas"> Reducir facturas energéticas</label>
                            <label><input type="checkbox" name="purpose" value="energia_limpia"> Generar energía limpia local</label>
                            <label><input type="checkbox" name="purpose" value="desarrollo_local"> Fomentar desarrollo local</label>
                            <label><input type="checkbox" name="purpose" value="lucha_pobreza"> Luchar contra pobreza energética</label>
                            <label><input type="checkbox" name="purpose" value="infraestructura"> Invertir en infraestructura pública</label>
                            <label><input type="checkbox" name="purpose" value="educacion"> Educación y formación ambiental</label>
                            <label><input type="checkbox" name="purpose" value="flexibilidad"> Aportar flexibilidad al sistema</label>
                        </div>
                        <div id="purpose-balance" class="interactive-area slider-container">
                            <label for="purpose-balance-slider">Balance énfasis:</label>
                            <span class="slider-label">Beneficio comunitario</span>
                            <input type="range" id="purpose-balance-slider" name="purpose_balance" min="0" max="100" value="70">
                            <span class="slider-label">Retorno financiero miembros</span>
                            <span id="purpose-balance-value" class="slider-value">70% Comunitario</span>
                        </div>
                    </div>

                    <div class="module">
                        <h3><span class="principle-tag">P1,P2,P4</span> Tipos de miembros</h3>
                        <p>¿Quiénes podrán formar parte de la comunidad?</p>
                        <div id="member-selector" class="interactive-area grid-checkboxes">
                             <label><input type="checkbox" name="member_type" value="hogares"> Hogares</label>
                             <label><input type="checkbox" name="member_type" value="hogares_vulnerables"> Hogares vulnerables</label>
                             <label><input type="checkbox" name="member_type" value="pymes"> PYMEs / Comercios locales</label>
                             <label><input type="checkbox" name="member_type" value="municipio"> Ayuntamiento / Entidad local</label>
                             <label><input type="checkbox" name="member_type" value="otros"> Otros (Asociaciones, etc.)</label>
                        </div>
                        <div id="member-composition-viz" class="visualization-area">
                            <p>Composición seleccionada:</p>
                            <ul id="member-list-viz"><li>(Selecciona tipos de miembros)</li></ul>
                        </div>
                    </div>

                    <div class="module">
                        <h3>Actividades principales</h3>
                        <p>¿Qué hará principalmente la comunidad energética?</p>
                        <div id="activity-selector" class="interactive-area grid-checkboxes">
                             <label><input type="checkbox" name="activity" value="generacion_fv"> Generación solar FV</label>
                             <label><input type="checkbox" name="activity" value="autoconsumo"> Autoconsumo compartido</label>
                             <label><input type="checkbox" name="activity" value="recarga_ve"> Puntos de recarga VE</label>
                             <label><input type="checkbox" name="activity" value="red_calor"> Red de calor/frío renovable</label>
                             <label><input type="checkbox" name="activity" value="eficiencia"> Asesoramiento eficiencia energética</label>
                             <label><input type="checkbox" name="activity" value="almacenamiento"> Almacenamiento energía</label>
                        </div>
                    </div>
                </section>

                <section id="step-2" class="step">
                    <h2>Paso 2: Adhesión voluntaria y abierta <span class="principle-tag">P1</span></h2>

                    <div class="module">
                        <h3>Nivel de apertura vs. compromiso</h3>
                        <div id="openness-slider" class="interactive-area slider-container">
                             <label for="openness-level">Nivel de apertura:</label>
                             <span class="slider-label">Máxima facilidad (pocos requisitos)</span>
                             <input type="range" id="openness-level" name="openness_level" min="0" max="100" value="60">
                             <span class="slider-label">Alto compromiso (requisitos específicos)</span>
                             <p id="openness-level-text" class="dynamic-text">Nivel intermedio de requisitos.</p>
                        </div>
                    </div>
                    <div class="module">
                        <h3>Criterios de elegibilidad</h3>
                         <p>(Deben ser no discriminatorios)</p>
                        <div id="eligibility-criteria" class="interactive-area grid-checkboxes">
                            <label><input type="checkbox" name="criteria" value="geografico"> Residencia/ubicación geográfica</label>
                            <label><input type="checkbox" name="criteria" value="tecnico"> Conexión técnica (ej. misma red BT)</label>
                            <label><input type="checkbox" name="criteria" value="inversion"> Aportación de capital mínima</label>
                            <label><input type="checkbox" name="criteria" value="consumo"> Ser consumidor de energía</label>
                            <label><input type="checkbox" name="criteria" value="participacion"> Compromiso de participación activa</label>
                        </div>
                    </div>
                     <div class="module">
                        <h3>Inclusión y diversidad</h3>
                        <p>¿Se implementarán medidas activas para fomentar la inclusión?</p>
                         <div id="inclusion-lever" class="interactive-area radio-group">
                            <label><input type="radio" name="inclusion_strategy" value="ninguna" checked> Sin medidas específicas</label>
                            <label><input type="radio" name="inclusion_strategy" value="basica"> Medidas básicas (difusión amplia)</label>
                            <label><input type="radio" name="inclusion_strategy" value="activa"> Medidas activas (cuotas reducidas, apoyo, outreach)</label>
                        </div>
                    </div>
                    <div class="module">
                        <h3>Miembro vs. cliente</h3>
                        <div id="member-vs-client-viz" class="visualization-area comparison">
                            <div class="comparison-item">
                                <h4>Miembro</h4>
                                <ul><li>Participa</li><li>Decide (Voto)</li><li>Invierte</li><li>Beneficios/Deberes</li></ul>
                            </div>
                            <div class="comparison-item">
                                <h4>Cliente</h4>
                                <ul><li>Consume</li><li>No decide</li><li>Paga servicio</li><li>Puede cambiar</li></ul>
                            </div>
                        </div>
                        <p class="disclaimer-viz">Esta visualización es conceptual y representa la diferencia fundamental según los principios cooperativos.</p>
                    </div>
                </section>

                <section id="step-3" class="step">
                     <h2>Paso 3: Control democrático de los miembros <span class="principle-tag">P2</span></h2>
                     <div class="module">
                         <h3>Estructura de voto principal</h3>
                         <div id="voting-balance" class="interactive-area radio-group">
                             <label><input type="radio" name="voting_structure" value="1m1v" checked> <strong>Un miembro, un voto:</strong> Igualdad total.</label>
                             <label><input type="radio" name="voting_structure" value="ponderado_tipo"> Voto ponderado por <strong>tipo de miembro</strong> (Hogar=1, Pyme=X...)</label>
                             <label><input type="radio" name="voting_structure" value="ponderado_aportacion"> Voto ponderado por <strong>aportación/consumo</strong></label>
                             <label><input type="radio" name="voting_structure" value="otro"> Otro sistema (especificar abajo)</label>
                         </div>
                         <div id="other-voting-description-container" class="interactive-area hidden other-input-container">
                            <label for="other_voting_description">Describe el sistema de voto "Otro":</label>
                            <textarea id="other_voting_description" name="other_voting_description" rows="3" placeholder="Ej: Sistema mixto con veto para ciertos grupos..."></textarea>
                         </div>
                         <div class="visualization-placeholder" id="voting-viz">
                            <div class="balance-scale"><div class="balance-beam" id="vote-beam"></div><div class="balance-base"></div></div>
                            <p id="voting-viz-text">Seleccionado: Un Miembro, Un Voto</p>
                        </div>
                     </div>
                     <div class="module">
                         <h3>Representación y órganos de gobierno</h3>
                         <p>¿Cómo se eligen los representantes (Consejo Rector/Junta)?</p>
                         <div id="group-representation" class="interactive-area">
                              <label for="governing_body">Elección principal:</label>
                              <select name="governing_body" id="governing_body">
                                  <option value="asamblea_general" selected>Elección directa por asamblea general</option>
                                  <option value="representantes_bloque">Elección por bloques/tipos de miembros</option>
                                  <option value="combinado">Sistema combinado</option>
                              </select>
                              <label class="checkbox-label"><input type="checkbox" name="reserved_seats" value="true"> ¿Habrá puestos reservados para ciertos tipos de miembros (ej. vulnerables, fundadores)?</label>
                         </div>
                     </div>
                      <div class="module">
                         <h3>Transparencia y rendición de cuentas</h3>
                         <p>¿Con qué frecuencia y cómo informará el órgano de gobierno?</p>
                         <div id="accountability-thermometer" class="interactive-area">
                            <label for="reporting_frequency">Frecuencia informes/asambleas:</label>
                            <select name="reporting_frequency" id="reporting_frequency">
                                <option value="anual">Anual</option>
                                <option value="semestral" selected>Semestral</option>
                                <option value="trimestral">Trimestral</option>
                                <option value="continua">Continua (web, etc.)</option>
                            </select>
                            <label class="checkbox-label"><input type="checkbox" name="public_access" value="true" checked> ¿Actas/decisiones accesibles a todos los miembros?</label>
                            <label class="checkbox-label"><input type="checkbox" name="external_audit" value="true"> ¿Auditoría externa periódica?</label>
                            <div class="visualization-placeholder">
                                 <div class="thermometer">
                                    <div class="thermometer-mercury" id="transparency-mercury"></div>
                                    <div class="thermometer-base"></div>
                                </div>
                                <p id="transparency-level-text">Nivel de transparencia: Alto</p>
                            </div>
                         </div>
                     </div>
                </section>

                <section id="step-4" class="step">
                     <h2>Paso 4: Participación económica de los miembros <span class="principle-tag">P3</span></h2>
                     <div class="module">
                         <h3>Formas de contribución económica</h3>
                         <p>¿Cómo aportarán los miembros al capital o funcionamiento?</p>
                         <div id="contribution-selector" class="interactive-area grid-checkboxes">
                             <label><input type="checkbox" name="contribution" value="cuota_entrada" checked> Cuota de entrada/inscripción</label>
                             <label><input type="checkbox" name="contribution" value="aportacion_capital"> Aportación de capital (participaciones)</label>
                             <label><input type="checkbox" name="contribution" value="cuota_periodica"> Cuota periódica (mantenimiento)</label>
                             <label><input type="checkbox" name="contribution" value="aportacion_especie"> Aportación en especie (ej. cesión tejado)</label>
                             <label><input type="checkbox" name="contribution" value="voluntariado"> Tiempo de voluntariado</label>
                         </div>
                     </div>
                     <div class="module">
                         <h3>Uso de excedentes/beneficios</h3>
                          <p>Si se generan excedentes, ¿cuál será la prioridad?</p>
                         <div id="surplus-use" class="interactive-area radio-group">
                             <label><input type="radio" name="surplus_priority" value="reparto_miembros"> Reparto entre miembros (según participación/actividad)</label>
                             <label><input type="radio" name="surplus_priority" value="reserva_obligatoria"> Dotar reservas obligatorias/voluntarias</label>
                             <label><input type="radio" name="surplus_priority" value="reinversion_comunidad" checked> Reinversión en proyectos/beneficios comunitarios (P7)</label>
                             <label><input type="radio" name="surplus_priority" value="combinado"> Combinación de las anteriores</label>
                         </div>
                     </div>
                     <div class="module">
                         <h3>Incentivos a la participación activa</h3>
                         <p>¿Se incentivará a los miembros por participar más?</p>
                         <div id="incentive-selector" class="interactive-area grid-checkboxes">
                              <label><input type="checkbox" name="incentive" value="descuento_factura"> Descuentos adicionales en factura</label>
                              <label><input type="checkbox" name="incentive" value="prioridad_servicios"> Prioridad en nuevos servicios (ej. cargador VE)</label>
                              <label><input type="checkbox" name="incentive" value="retorno_diferenciado"> Retorno económico diferenciado (si aplica)</label>
                              <label><input type="checkbox" name="incentive" value="reconocimiento"> Reconocimiento público/social</label>
                              <label><input type="checkbox" name="incentive" value="ninguno"> Sin incentivos específicos (igual para todos)</label>
                         </div>
                     </div>
                </section>

                <section id="step-5" class="step">
                     <h2>Paso 5: Autonomía e independencia <span class="principle-tag">P4</span></h2>
                      <div class="module">
                         <h3>Control y toma de decisiones</h3>
                          <p>Asegurar que la comunidad es controlada por sus miembros.</p>
                         <div class="interactive-area radio-group">
                            <label><input type="radio" name="decision_control" value="miembros_exclusivo" checked> Decisiones estratégicas exclusivas de la asamblea general</label>
                            <label><input type="radio" name="decision_control" value="miembros_mayoritario"> Control mayoritario de los miembros en todas las decisiones</label>
                            <label><input type="radio" name="decision_control" value="externos_consultivo"> Participación externa sólo consultiva/técnica</label>
                         </div>
                     </div>
                     <div class="module">
                         <h3>Relación con entidades externas</h3>
                         <p>(Inversores, administraciones, etc.)</p>
                         <div id="external-relations" class="interactive-area">
                            <label for="external_funding_limit">Límite a la financiación/participación externa (% del capital total):</label>
                            <input type="number" name="external_funding_limit" id="external_funding_limit" value="25" min="0" max="75" step="5"> %
                            <p class="dynamic-text">Un límite bajo refuerza la autonomía.</p>
                             <label class="checkbox-label"><input type="checkbox" name="veto_rights_members" value="true"> ¿Derecho de veto de los miembros sobre acuerdos clave con externos?</label>
                            <label class="checkbox-label"><input type="checkbox" name="autonomy_clause" value="true" checked> Incluir cláusula explícita de autonomía en estatutos</label>
                         </div>
                         <div class="visualization-placeholder">
                             <div class="autonomy-shield" id="autonomy-shield-viz">
                                <div class="shield-layer" id="shield-layer-1"></div>
                                <div class="shield-layer" id="shield-layer-2"></div>
                                <div class="shield-layer" id="shield-layer-3"></div>
                                <span>AUTONOMÍA</span>
                             </div>
                             <p id="autonomy-level-text">Nivel de Autonomía: Alto</p>
                        </div>
                         <div id="dependency-alert" class="alert-area hidden">
                             ⚠️ ¡Atención! Un alto nivel de dependencia externa podría comprometer la autonomía. Revisa las condiciones.
                         </div>
                     </div>
                 </section>

                <section id="step-6" class="step">
                    <h2>Paso 6: Educación, formación e información <span class="principle-tag">P5</span></h2>
                    <div class="module">
                        <h3>Actividades de educación y formación</h3>
                        <p>¿Qué acciones se realizarán para informar y capacitar?</p>
                        <div id="education-activities" class="interactive-area grid-checkboxes">
                            <label><input type="checkbox" name="education" value="info_miembros" checked> Información regular a miembros sobre funcionamiento y energía</label>
                            <label><input type="checkbox" name="education" value="formacion_gobierno"> Formación para miembros del órgano de gobierno</label>
                            <label><input type="checkbox" name="education" value="talleres_publico"> Talleres/charlas para la comunidad local</label>
                            <label><input type="checkbox" name="education" value="material_divulgativo"> Creación de material divulgativo (web, folletos)</label>
                            <label><input type="checkbox" name="education" value="colaboracion_escuelas"> Colaboración con centros educativos</label>
                        </div>
                    </div>
                     <div class="module">
                         <h3>Impacto del conocimiento</h3>
                         <div class="visualization-placeholder">
                             <div class="knowledge-tree" id="knowledge-tree-viz">
                                 <div class="tree-trunk"></div>
                                 <div class="tree-branches" id="tree-branches-viz">
                                     <div class="branch"></div> </div>
                                 <div class="tree-base">EDUCACIÓN</div>
                             </div>
                             <p id="knowledge-impact-text">Nivel de compromiso educativo: Moderado</p>
                         </div>
                     </div>
                </section>

                <section id="step-7" class="step">
                     <h2>Paso 7: Cooperación entre comunidades <span class="principle-tag">P6</span></h2>
                      <div class="module">
                         <h3>Nivel de cooperación inter-comunitaria</h3>
                         <p>¿Se buscará activamente la colaboración con otras comunidades energéticas?</p>
                         <div id="cooperation-level" class="interactive-area radio-group">
                            <label><input type="radio" name="cooperation_level_radio" value="baja"> Cooperación baja o puntual</label>
                            <label><input type="radio" name="cooperation_level_radio" value="media" checked> Cooperación moderada (intercambio de información)</label>
                            <label><input type="radio" name="cooperation_level_radio" value="alta"> Cooperación alta (proyectos conjuntos, redes)</label>
                        </div>
                     </div>
                      <div class="module">
                         <h3>Áreas de cooperación potenciales</h3>
                         <div id="cooperation-areas" class="interactive-area grid-checkboxes">
                             <label><input type="checkbox" name="cooperation_area" value="conocimiento"> Intercambio de conocimiento y buenas prácticas</label>
                             <label><input type="checkbox" name="cooperation_area" value="compras_conjuntas"> Compras conjuntas (ej. paneles solares)</label>
                             <label><input type="checkbox" name="cooperation_area" value="proyectos_conjuntos"> Desarrollo de proyectos conjuntos</label>
                             <label><input type="checkbox" name="cooperation_area" value="representacion"> Representación e incidencia política conjunta</label>
                             <label><input type="checkbox" name="cooperation_area" value="servicios_compartidos"> Servicios técnicos o administrativos compartidos</label>
                         </div>
                          <div class="visualization-placeholder">
                              <div class="cooperation-map">
                                <div class="map-node self">Tu Comunidad</div>
                                <div class="map-link" id="coop-link-1"></div>
                                <div class="map-node other" id="coop-node-1">Otra CE</div>
                                <div class="map-link" id="coop-link-2"></div>
                                <div class="map-node other" id="coop-node-2">Red Local</div>
                              </div>
                              <p id="cooperation-viz-text">Nivel de interconexión: Moderado</p>
                          </div>
                     </div>
                </section>

                <section id="step-8" class="step">
                     <h2>Paso 8: Interés por la comunidad local <span class="principle-tag">P7</span></h2>
                     <div class="module">
                         <h3>Prioridad del beneficio comunitario</h3>
                         <p>Reafirmar el foco en los beneficios para la comunidad local más allá de los miembros.</p>
                         <div id="community-focus" class="interactive-area radio-group">
                             <label><input type="radio" name="community_focus_radio" value="secundario"> Beneficio comunitario secundario al de miembros</label>
                             <label><input type="radio" name="community_focus_radio" value="importante"> Beneficio comunitario importante, al mismo nivel</label>
                             <label><input type="radio" name="community_focus_radio" value="primario" checked> Beneficio comunitario como fin primario</label>
                         </div>
                     </div>
                     <div class="module">
                         <h3>Mecanismos de reinversión en la comunidad</h3>
                         <p>¿Cómo se materializará el interés por la comunidad?</p>
                         <div id="reinvestment-mechanisms" class="interactive-area grid-checkboxes">
                             <label><input type="checkbox" name="reinvestment" value="proyectos_locales" checked> Financiación directa de proyectos locales (sociales, ambientales)</label>
                             <label><input type="checkbox" name="reinvestment" value="tarifas_sociales"> Tarifas energéticas sociales para colectivos vulnerables</label>
                             <label><input type="checkbox" name="reinvestment" value="infraestructura_publica"> Inversión en infraestructura energética pública local</label>
                             <label><input type="checkbox" name="reinvestment" value="fondo_social"> Creación de un fondo social/ambiental específico</label>
                             <label><input type="checkbox" name="reinvestment" value="empleo_local"> Fomento del empleo local</label>
                         </div>
                     </div>
                     <div class="module">
                         <h3>Medidor de impacto comunitario</h3>
                         <div class="visualization-placeholder">
                             <div class="impact-meter">
                                <div class="meter-needle" id="impact-needle"></div>
                                <div class="meter-scale">
                                    <span class="scale-min">Bajo</span>
                                    <span class="scale-mid">Medio</span>
                                    <span class="scale-max">Alto</span>
                                </div>
                             </div>
                             <p id="impact-level-text">Impacto comunitario potencial: Alto</p>
                         </div>
                     </div>
                </section>

                <section id="step-final" class="step">
                    <h2>Paso final: Revisa y refina tu diseño de gobernanza</h2>

                    <div class="module">
                        <h3>Dashboard de decisiones clave</h3>
                        <div id="governance-dashboard" class="dashboard-area">
                            <p><em>Generando resumen de decisiones...</em></p>
                        </div>
                    </div>

                    <div class="module">
                        <h3>Puntuación de alineación con principios ACI</h3>
                         <p>(Esta puntuación es ilustrativa)</p>
                        <div id="aci-alignment-score" class="visualization-area radar-chart-container">
                            <canvas id="aciRadarChart"></canvas>
                        </div>
                         <p class="disclaimer">Nota: Esta puntuación se basa en una interpretación simplificada. Un análisis detallado requiere consulta experta.</p>
                    </div>

                     <div class="module">
                        <h3>Borrador preliminar de gobernanza</h3>
                        <div id="draft-output" class="output-area">
                            <p><em>Generando borrador de puntos clave...</em></p>
                        </div>
                        <button id="download-draft-btn" class="action-button" disabled>Descargar borrador (PDF)</button>
                         <p class="disclaimer">Este es un borrador preliminar y no un documento legal. Debe ser revisado por asesores legales/expertos.</p>
                    </div>
                </section>

            </div> </form> <div id="navigation-buttons">
            <button id="reset-btn" class="secondary-button" disabled>Reiniciar</button>
            <button id="prev-btn" disabled>Anterior</button>
            <button id="next-btn" class="primary-button">Siguiente</button>
        </div>

    </main>

    <footer>
        <p>Gobernanza Energética - Herramienta conceptual | Basado en principios ACI</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
